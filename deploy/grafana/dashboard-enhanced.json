{
  "id": null,
  "uid": "nextcloud-perf-enhanced",
  "title": "Nextcloud Performance Monitor - Enhanced Analytics",
  "tags": ["nextcloud", "performance", "analytics", "history"],
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 3,
  "refresh": "1m",
  "panels": [
    {
      "type": "row",
      "title": "üìä Current Performance",
      "collapsed": false,
      "gridPos": { "x": 0, "y": 0, "w": 24, "h": 1 },
      "id": 100
    },
    {
      "type": "stat",
      "title": "Current Upload Speed",
      "targets": [
        {
          "expr": "avg_over_time(nextcloud_test_speed_mbytes_per_sec{service=~\"$service\",type=\"upload\"}[5m])",
          "refId": "A",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        }
      ],
      "fieldConfig": { 
        "defaults": { 
          "unit": "MB/s",
          "color": { "mode": "thresholds" },
          "thresholds": {
            "steps": [
              { "color": "red", "value": 0 },
              { "color": "yellow", "value": 5 },
              { "color": "green", "value": 10 }
            ]
          }
        } 
      },
      "gridPos": { "x": 0, "y": 1, "w": 6, "h": 6 },
      "id": 1
    },
    {
      "type": "stat",
      "title": "Current Download Speed",
      "targets": [
        {
          "expr": "avg_over_time(nextcloud_test_speed_mbytes_per_sec{service=~\"$service\",type=\"download\"}[5m])",
          "refId": "A",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        }
      ],
      "fieldConfig": { 
        "defaults": { 
          "unit": "MB/s",
          "color": { "mode": "thresholds" },
          "thresholds": {
            "steps": [
              { "color": "red", "value": 0 },
              { "color": "yellow", "value": 8 },
              { "color": "green", "value": 15 }
            ]
          }
        } 
      },
      "gridPos": { "x": 6, "y": 1, "w": 6, "h": 6 },
      "id": 2
    },
    {
      "type": "stat",
      "title": "Success Rate (24h)",
      "targets": [
        {
          "expr": "nextcloud_daily_success_rate_percent{service=~\"$service\"}",
          "refId": "A",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        }
      ],
      "fieldConfig": { 
        "defaults": { 
          "unit": "percent",
          "min": 0,
          "max": 100,
          "color": { "mode": "thresholds" },
          "thresholds": {
            "steps": [
              { "color": "red", "value": 0 },
              { "color": "yellow", "value": 90 },
              { "color": "green", "value": 95 }
            ]
          }
        } 
      },
      "gridPos": { "x": 12, "y": 1, "w": 6, "h": 6 },
      "id": 3
    },
    {
      "type": "stat",
      "title": "Tests Today",
      "targets": [
        {
          "expr": "sum(nextcloud_daily_test_count{service=~\"$service\"})",
          "refId": "A",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        }
      ],
      "fieldConfig": { "defaults": { "unit": "short" } },
      "gridPos": { "x": 18, "y": 1, "w": 6, "h": 6 },
      "id": 4
    },
    {
      "type": "row",
      "title": "üìà Daily Averages (24 Hours)",
      "collapsed": false,
      "gridPos": { "x": 0, "y": 7, "w": 24, "h": 1 },
      "id": 101
    },
    {
      "type": "bargauge",
      "title": "Daily Average Upload Speed by Service",
      "targets": [
        {
          "expr": "nextcloud_daily_average_upload_speed_mbytes_per_sec{service=~\"$service\"}",
          "legendFormat": "{{service}} - {{instance}}",
          "refId": "A",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        }
      ],
      "fieldConfig": { 
        "defaults": { 
          "unit": "MB/s",
          "displayMode": "gradient",
          "orientation": "horizontal"
        } 
      },
      "gridPos": { "x": 0, "y": 8, "w": 12, "h": 8 },
      "id": 5
    },
    {
      "type": "bargauge",
      "title": "Daily Average Download Speed by Service",
      "targets": [
        {
          "expr": "nextcloud_daily_average_download_speed_mbytes_per_sec{service=~\"$service\"}",
          "legendFormat": "{{service}} - {{instance}}",
          "refId": "A",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        }
      ],
      "fieldConfig": { 
        "defaults": { 
          "unit": "MB/s",
          "displayMode": "gradient",
          "orientation": "horizontal"
        } 
      },
      "gridPos": { "x": 12, "y": 8, "w": 12, "h": 8 },
      "id": 6
    },
    {
      "type": "row",
      "title": "üìÖ Monthly Trends (30 Days)",
      "collapsed": false,
      "gridPos": { "x": 0, "y": 16, "w": 24, "h": 1 },
      "id": 102
    },
    {
      "type": "stat",
      "title": "Monthly Avg Upload",
      "targets": [
        {
          "expr": "avg(nextcloud_monthly_average_upload_speed_mbytes_per_sec{service=~\"$service\"})",
          "refId": "A",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        }
      ],
      "fieldConfig": { 
        "defaults": { 
          "unit": "MB/s",
          "color": { "mode": "palette-classic" }
        } 
      },
      "gridPos": { "x": 0, "y": 17, "w": 6, "h": 4 },
      "id": 7
    },
    {
      "type": "stat",
      "title": "Monthly Avg Download",
      "targets": [
        {
          "expr": "avg(nextcloud_monthly_average_download_speed_mbytes_per_sec{service=~\"$service\"})",
          "refId": "A",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        }
      ],
      "fieldConfig": { 
        "defaults": { 
          "unit": "MB/s",
          "color": { "mode": "palette-classic" }
        } 
      },
      "gridPos": { "x": 6, "y": 17, "w": 6, "h": 4 },
      "id": 8
    },
    {
      "type": "timeseries",
      "title": "Monthly Performance Trend",
      "targets": [
        {
          "expr": "nextcloud_monthly_average_upload_speed_mbytes_per_sec{service=~\"$service\"}",
          "legendFormat": "Upload - {{service}}",
          "refId": "A",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        },
        {
          "expr": "nextcloud_monthly_average_download_speed_mbytes_per_sec{service=~\"$service\"}",
          "legendFormat": "Download - {{service}}",
          "refId": "B",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        }
      ],
      "fieldConfig": { "defaults": { "unit": "MB/s" } },
      "gridPos": { "x": 12, "y": 17, "w": 12, "h": 8 },
      "id": 9
    },
    {
      "type": "row",
      "title": "üèÜ Service Performance Ranking",
      "collapsed": false,
      "gridPos": { "x": 0, "y": 25, "w": 24, "h": 1 },
      "id": 103
    },
    {
      "type": "table",
      "title": "Service Performance Rankings",
      "targets": [
        {
          "expr": "sort_desc(avg_over_time(nextcloud_test_speed_mbytes_per_sec{service=~\"$service\",type=\"upload\"}[24h]))",
          "format": "table",
          "refId": "A",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        },
        {
          "expr": "sort_desc(avg_over_time(nextcloud_test_speed_mbytes_per_sec{service=~\"$service\",type=\"download\"}[24h]))",
          "format": "table",
          "refId": "B",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "displayMode": "color-background",
            "align": "center"
          }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Value" },
            "properties": [
              { "id": "unit", "value": "MB/s" },
              {
                "id": "thresholds",
                "value": {
                  "steps": [
                    { "color": "red", "value": 0 },
                    { "color": "yellow", "value": 5 },
                    { "color": "green", "value": 10 }
                  ]
                }
              }
            ]
          }
        ]
      },
      "gridPos": { "x": 0, "y": 26, "w": 12, "h": 8 },
      "id": 10
    },
    {
      "type": "timeseries",
      "title": "Real-time Performance vs Daily Average",
      "targets": [
        {
          "expr": "avg_over_time(nextcloud_test_speed_mbytes_per_sec{service=~\"$service\",type=\"upload\"}[1m])",
          "legendFormat": "Current Upload - {{service}}",
          "refId": "A",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        },
        {
          "expr": "nextcloud_daily_average_upload_speed_mbytes_per_sec{service=~\"$service\"}",
          "legendFormat": "Daily Avg Upload - {{service}}",
          "refId": "B",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        },
        {
          "expr": "avg_over_time(nextcloud_test_speed_mbytes_per_sec{service=~\"$service\",type=\"download\"}[1m])",
          "legendFormat": "Current Download - {{service}}",
          "refId": "C",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        },
        {
          "expr": "nextcloud_daily_average_download_speed_mbytes_per_sec{service=~\"$service\"}",
          "legendFormat": "Daily Avg Download - {{service}}",
          "refId": "D",
          "datasource": { "type": "prometheus", "uid": "prometheus" }
        }
      ],
      "fieldConfig": { 
        "defaults": { 
          "unit": "MB/s",
          "custom": {
            "lineInterpolation": "smooth"
          }
        } 
      },
      "gridPos": { "x": 12, "y": 26, "w": 12, "h": 8 },
      "id": 11
    }
  ],
  "templating": {
    "list": [
      {
        "name": "service",
        "type": "query",
        "datasource": "Prometheus",
        "query": "label_values(nextcloud_test_duration_seconds,service)",
        "refresh": 1,
        "includeAll": true,
        "multi": true,
        "current": {
          "selected": true,
          "text": "All",
          "value": "$__all"
        }
      }
    ]
  },
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "annotations": { "list": [] }
}
